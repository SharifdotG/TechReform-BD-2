{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% load custom_filters %}
{% block title %}Your Cart - TechReform BD{% endblock %}

{% block content %}
<!-- Cart Section -->
<section class="py-16 bg-base-100 overflow-hidden">
    <div class="container mx-auto px-6 relative">
        <!-- Enhanced Animated Background Elements -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none z-0">
            <!-- Large soft glow top right -->
            <div class="absolute -top-48 -right-48 w-[32rem] h-[32rem] bg-gradient-to-br from-primary/60 via-secondary/40 to-yellow-400/30 rounded-full blur-[120px] animate-pulse-slow"></div>
            <!-- Subtle color orb left center -->
            <div class="absolute top-1/3 -left-56 w-[28rem] h-[28rem] bg-gradient-to-tr from-secondary/50 via-primary/30 to-pink-400/20 rounded-full blur-[100px] animate-pulse-slower"></div>
            <!-- Floating yellow orb bottom center -->
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-72 h-72 bg-gradient-to-t from-yellow-300/60 via-primary/30 to-transparent rounded-full blur-2xl animate-float"></div>
            <!-- Extra accent: blue/purple ring, subtle, bottom right -->
            <div class="absolute bottom-12 right-12 w-40 h-40 border-8 border-blue-400/30 rounded-full blur-lg animate-float" style="animation-delay: 2s;"></div>
            <!-- Extra accent: pink dot, top left -->
            <div class="absolute top-10 left-10 w-16 h-16 bg-pink-400/40 rounded-full blur-xl animate-pulse-slower" style="animation-delay: 1.5s;"></div>
        </div>

        <!-- Section heading with enhanced modern design and subtle glassmorphism -->
        <div class="relative z-10 text-center mb-14">
            <div class="absolute inset-0 flex justify-center items-center pointer-events-none">
            <!-- Soft blurred orb background accent -->
            <div class="w-60 h-60 bg-gradient-to-br from-yellow-300/30 via-primary/20 to-secondary/20 rounded-full blur-3xl opacity-70"></div>
            </div>
            <span class="inline-flex items-center gap-2 bg-white/70 backdrop-blur-md border border-primary/10 shadow-lg text-primary font-semibold py-2 px-7 rounded-full text-base animate-fade-in-down">
            <svg class="w-6 h-6 text-yellow-400 animate-bounce" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke-linecap="round" stroke-linejoin="round"></path>
                <circle cx="7" cy="21" r="1"></circle>
                <circle cx="17" cy="21" r="1"></circle>
            </svg>
            <span class="tracking-wide">Shopping Cart</span>
            </span>
            <h2 class="mt-5 text-4xl lg:text-5xl font-extrabold bg-gradient-to-r from-primary via-secondary to-yellow-400 bg-clip-text text-transparent drop-shadow-xl animate-fade-in-up tracking-tight">
            Your Cart Items
            </h2>
            <div class="w-36 h-1 bg-gradient-to-r from-yellow-400 via-primary to-secondary mx-auto mt-7 rounded-full animate-grow shadow-md"></div>
            <p class="mt-5 text-gray-600 max-w-2xl mx-auto text-lg animate-fade-in font-medium">
            <span class="inline-flex items-center gap-1">
                <i class="lni lni-star text-yellow-400"></i>
                <span>Handpicked just for you.</span>
            </span>
            <br>
            <span class="text-gray-500">Review your selected products and proceed to checkout when you're ready!</span>
            </p>
        </div>

        <!-- Enhanced Custom Animations & Effects -->
        <style>
            /* Soft glowing pulse for orbs */
            @keyframes pulse-slow {
            0%, 100% { opacity: 0.75; filter: blur(0px) brightness(1); transform: scale(1);}
            50% { opacity: 1; filter: blur(2px) brightness(1.08); transform: scale(1.12);}
            }
            @keyframes pulse-slower {
            0%, 100% { opacity: 0.5; filter: blur(0px) brightness(1); transform: scale(1);}
            50% { opacity: 0.85; filter: blur(3px) brightness(1.12); transform: scale(1.18);}
            }
            /* Floating effect for orbs */
            @keyframes float {
            0%, 100% { transform: translateY(0) scale(1);}
            50% { transform: translateY(-28px) scale(1.06);}
            }
            /* Fade-in from top */
            @keyframes fade-in-down {
            0% { opacity: 0; transform: translateY(-32px);}
            100% { opacity: 1; transform: translateY(0);}
            }
            /* Fade-in from bottom */
            @keyframes fade-in-up {
            0% { opacity: 0; transform: translateY(32px);}
            100% { opacity: 1; transform: translateY(0);}
            }
            /* Simple fade-in */
            @keyframes fade-in {
            0% { opacity: 0;}
            100% { opacity: 1;}
            }
            /* Grow animation for accent bar */
            @keyframes grow {
            0% { width: 0;}
            100% { width: 9rem;}
            }
            /* Subtle shimmer for glassmorphism */
            @keyframes shimmer {
            0% { background-position: -400px 0; }
            100% { background-position: 400px 0; }
            }
            .animate-pulse-slow { animation: pulse-slow 6s ease-in-out infinite; }
            .animate-pulse-slower { animation: pulse-slower 10s ease-in-out infinite; }
            .animate-float { animation: float 8s ease-in-out infinite; }
            .animate-fade-in-down { animation: fade-in-down 1s cubic-bezier(.4,0,.2,1) both; }
            .animate-fade-in-up { animation: fade-in-up 1.2s cubic-bezier(.4,0,.2,1) both; }
            .animate-fade-in { animation: fade-in 1.6s cubic-bezier(.4,0,.2,1) both; }
            .animate-grow { animation: grow 1.3s cubic-bezier(.4,0,.2,1) both; }
            /* Glassmorphism shimmer effect */
            .glass-shimmer {
            position: relative;
            overflow: hidden;
            }
            .glass-shimmer::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(120deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.22) 50%, rgba(255,255,255,0.08) 100%);
            background-size: 400px 100%;
            animation: shimmer 2.5s linear infinite;
            pointer-events: none;
            z-index: 1;
            }
        </style>

        <!-- Cart Content -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            {% if cart_items %}
            <div class="overflow-x-auto animate-fade-in-up transition-all duration-700">
                <table class="w-full min-w-full table-auto rounded-xl shadow-xl bg-white/80 backdrop-blur-lg glass-shimmer">
                    <thead class="bg-gradient-to-r from-primary/20 via-yellow-100 to-secondary/20 text-gray-800 shadow-md">
                        <tr>
                            <th class="py-6 px-7 text-left font-extrabold tracking-wider text-xl rounded-tl-xl bg-white/70 backdrop-blur-md border-b-2 border-primary/20 shadow-sm">
                                <span class="flex items-center gap-2">
                                    <i class="lni lni-package text-primary text-2xl"></i>
                                    Product
                                </span>
                            </th>
                            <th class="py-6 px-7 text-center font-bold tracking-wide text-lg bg-white/70 backdrop-blur-md border-b-2 border-primary/20 shadow-sm">
                                <span class="flex items-center gap-2 justify-center">
                                    <i class="lni lni-tag text-yellow-500 text-xl"></i>
                                    Price
                                </span>
                            </th>
                            <th class="py-6 px-7 text-center font-bold tracking-wide text-lg bg-white/70 backdrop-blur-md border-b-2 border-primary/20 shadow-sm">
                                <span class="flex items-center gap-2 justify-center">
                                    <i class="lni lni-spinner-arrow text-secondary text-xl"></i>
                                    Quantity
                                </span>
                            </th>
                            <th class="py-6 px-7 text-center font-bold tracking-wide text-lg bg-white/70 backdrop-blur-md border-b-2 border-primary/20 shadow-sm">
                                <span class="flex items-center gap-2 justify-center">
                                    <i class="lni lni-calculator text-primary text-xl"></i>
                                    Total
                                </span>
                            </th>
                            <th class="py-6 px-7 text-center font-bold tracking-wide text-lg rounded-tr-xl bg-white/70 backdrop-blur-md border-b-2 border-primary/20 shadow-sm">
                                <span class="flex items-center gap-2 justify-center">
                                    <i class="lni lni-cogs text-red-400 text-xl"></i>
                                    Actions
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200" id="cart-items-container">
                        {% for item in cart_items %}
                        <tr class="hover:bg-gradient-to-r hover:from-yellow-50 hover:via-primary/10 hover:to-secondary/10 transition-all duration-300 group" id="cart-item-{{ item.id }}">
                            <td class="py-5 px-6 align-middle">
                                <div class="flex items-center gap-5">
                                    <div class="relative flex-shrink-0">
                                        {% if item.product.image1 %}
                                        <div class="bg-gradient-to-br from-primary/10 via-yellow-100 to-secondary/10 p-1 rounded-xl shadow-lg">
                                            <img src="{{ item.product.image1.url }}" alt="{{ item.product.brand }} {{ item.product.model }}"
                                                 class="w-16 h-16 object-cover rounded-lg shadow-md border-2 border-primary/30 group-hover:scale-110 transition-transform duration-300 ease-in-out">
                                        </div>
                                        {% else %}
                                        <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center shadow-md border-2 border-gray-300">
                                            <i class="lni lni-package text-gray-400 text-2xl"></i>
                                        </div>
                                        {% endif %}
                                        {% if item.product.is_new %}
                                        <span class="absolute -top-2 -right-2 bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-300 text-white text-xs font-bold px-2 py-0.5 rounded-full shadow-lg animate-bounce border border-white">New</span>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 group-hover:text-primary transition-colors duration-300 text-base leading-tight flex items-center gap-2">
                                            {{ item.product.brand }} <span class="font-normal text-gray-400">|</span> {{ item.product.model }}
                                        </h3>
                                        <p class="text-xs text-gray-500 mt-1 italic">{{ item.product_category }}</p>
                                        {% if item.product.short_description %}
                                        <p class="text-xs text-gray-400 mt-0.5 line-clamp-1">{{ item.product.short_description }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td class="py-5 px-6 text-center align-middle">
                                <div class="flex flex-col items-center gap-1">
                                    <span class="font-extrabold text-primary text-xl drop-shadow-sm animate-fade-in">
                                        ৳{{ item.price|floatformat:0|intcomma }}
                                    </span>
                                    {% if item.product.regular_price and item.product.price < item.product.regular_price %}
                                    <span class="text-xs text-gray-400 line-through animate-fade-in">
                                        ৳{{ item.product.regular_price|floatformat:0|intcomma }}
                                    </span>
                                    <span class="inline-flex items-center gap-1 bg-yellow-100 text-yellow-700 text-xs font-semibold px-2 py-0.5 rounded-full shadow-sm mt-1 animate-bounce">
                                        <i class="lni lni-offer text-yellow-500"></i>
                                        {{ item.product.regular_price|discount_percent:item.product.price }} OFF
                                    </span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="py-5 px-6 text-center">
                                <div class="flex items-center justify-center">
                                    <div class="flex items-center bg-white/80 border-2 border-primary/10 rounded-full shadow-md overflow-hidden">
                                        <button type="button"
                                                class="px-3 py-1.5 bg-gradient-to-br from-primary/10 to-yellow-100 hover:from-primary/20 hover:to-yellow-200 text-primary font-bold transition-all duration-200 quantity-btn focus:outline-none focus:ring-2 focus:ring-primary/30"
                                                data-action="decrease"
                                                data-item-id="{{ item.id }}">
                                            <span class="text-lg leading-none">−</span>
                                        </button>
                                        <input type="number"
                                               value="{{ item.quantity }}"
                                               min="1"
                                               max="99"
                                               class="w-14 text-center bg-transparent border-x-0 font-semibold text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary/20 quantity-input transition-all duration-200"
                                               data-item-id="{{ item.id }}">
                                        <button type="button"
                                                class="px-3 py-1.5 bg-gradient-to-br from-primary/10 to-yellow-100 hover:from-primary/20 hover:to-yellow-200 text-primary font-bold transition-all duration-200 quantity-btn focus:outline-none focus:ring-2 focus:ring-primary/30"
                                                data-action="increase"
                                                data-item-id="{{ item.id }}">
                                            <span class="text-lg leading-none">+</span>
                                        </button>
                                    </div>
                                </div>
                            </td>
                            <td class="py-5 px-6 text-center font-bold item-total text-lg animate-fade-in" data-item-id="{{ item.id }}">
                                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-gradient-to-r from-yellow-100 via-primary/10 to-secondary/10 shadow-md border border-primary/10 text-primary font-extrabold tracking-wide transition-all duration-300 group-hover:scale-105 group-hover:bg-yellow-200/70">
                                    <i class="lni lni-calculator text-yellow-500 text-xl"></i>
                                    ৳{{ item.get_total|floatformat:0|intcomma }}
                                </span>
                            </td>
                            <td class="py-5 px-6 text-center align-middle">
                                <button type="button"
                                        class="inline-flex items-center gap-2 group px-4 py-2 rounded-full border-2 border-red-100 bg-gradient-to-r from-red-50 via-white to-red-100 hover:from-red-500 hover:to-red-400 hover:text-white hover:border-red-400 transition-all duration-200 shadow-md remove-item-btn focus:outline-none focus:ring-2 focus:ring-red-300/40"
                                        data-item-id="{{ item.id }}">
                                    <span class="relative flex items-center justify-center">
                                        <span class="absolute -inset-1 rounded-full bg-red-400 opacity-0 group-hover:opacity-30 transition-all duration-200"></span>
                                        <i class="lni lni-trash-can text-lg group-hover:animate-bounce group-hover:text-white text-red-500 transition-colors duration-200"></i>
                                    </span>
                                    <span class="hidden md:inline font-semibold group-hover:text-white text-red-500 transition-colors duration-200">Remove</span>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Cart Summary with Enhanced Design & Animations -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-6 mt-4 animate-fade-in-up transition-all duration-700">
                <!-- Continue Shopping & Shipping Info -->
                <div class="space-y-6 flex flex-col justify-between h-full">
                    <a href="{% url 'product-list' %}" class="inline-flex items-center gap-3 px-5 py-3 bg-gradient-to-r from-primary/10 via-yellow-50 to-secondary/10 rounded-full shadow-md border border-primary/10 hover:from-primary/20 hover:to-yellow-100 hover:shadow-lg transition-all duration-300 font-semibold text-primary group">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 group-hover:bg-primary group-hover:text-white transition-all duration-300">
                            <i class="lni lni-arrow-left text-lg group-hover:animate-bounce"></i>
                        </span>
                        <span class="text-base group-hover:text-primary/90 transition-all duration-300 tracking-wide">
                            Continue Shopping
                        </span>
                    </a>
                    <div class="relative mt-8">
                        <!-- Animated Glow Accent -->
                        <div class="absolute -top-8 -left-8 w-28 h-28 bg-gradient-to-br from-yellow-300/40 via-yellow-100/60 to-primary/20 rounded-full blur-3xl opacity-80 animate-pulse-slow z-0"></div>
                        <div class="relative z-10 p-7 bg-gradient-to-br from-yellow-50 via-white to-yellow-100 rounded-3xl border border-yellow-200/60 shadow-2xl glass-shimmer animate-fade-in">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-yellow-100 shadow-md">
                                    <i class="lni lni-delivery text-2xl text-yellow-500 animate-float"></i>
                                </span>
                                <h4 class="font-bold text-lg text-yellow-700 tracking-tight">Shipping Information</h4>
                            </div>
                            <ul class="space-y-2 mt-2">
                                <li class="flex items-center gap-2 text-base text-gray-700">
                                    <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-green-100">
                                        <i class="lni lni-gift text-green-500 animate-bounce"></i>
                                    </span>
                                    <span>
                                        <span class="font-semibold text-primary">Free shipping</span>
                                        <span class="text-gray-600">on orders over</span>
                                        <span class="font-bold text-primary">৳10,000</span>
                                    </span>
                                </li>
                                <li class="flex items-center gap-2 text-base text-gray-700">
                                    <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-primary/10">
                                        <i class="lni lni-timer text-primary animate-pulse-slow"></i>
                                    </span>
                                    <span>
                                        <span class="font-medium text-gray-700">Standard delivery:</span>
                                        <span class="text-gray-600">2-5 business days</span>
                                    </span>
                                </li>
                                <li class="flex items-center gap-2 text-base text-gray-700">
                                    <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-yellow-100">
                                        <i class="lni lni-shield text-yellow-500"></i>
                                    </span>
                                    <span>
                                        <span class="font-medium text-gray-700">Secure packaging & tracking included</span>
                                    </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Order Summary Card - Enhanced Design & Animations -->
                <div class="relative bg-gradient-to-br from-white via-yellow-50 to-primary/5 p-10 rounded-3xl shadow-2xl border border-primary/10 glass-shimmer animate-fade-in-up transition-all duration-700 overflow-hidden group">
                    <!-- Enhanced Animated Accent Glow & Rings -->
                    <div class="absolute -top-12 -right-12 w-40 h-40 bg-gradient-to-br from-yellow-300/60 via-primary/30 to-secondary/20 rounded-full blur-[90px] opacity-90 animate-pulse-slow z-0"></div>
                    <div class="absolute -bottom-10 left-1/2 -translate-x-1/2 w-32 h-32 border-[10px] border-yellow-400/30 rounded-full blur-2xl animate-float z-0"></div>
                    <div class="absolute top-10 left-10 w-14 h-14 bg-primary/20 rounded-full blur-2xl animate-pulse-slower z-0"></div>
                    <div class="absolute bottom-8 right-16 w-10 h-10 bg-gradient-to-tr from-secondary/40 via-yellow-200/30 to-primary/10 rounded-full blur-xl animate-float z-0"></div>
                    <div class="absolute top-1/2 left-0 -translate-y-1/2 w-8 h-8 bg-yellow-400/30 rounded-full blur-lg animate-pulse-slow z-0"></div>
                    <div class="relative z-10">
                        <div class="flex items-center gap-4 mb-8 animate-fade-in-down">
                            <span class="relative inline-flex items-center justify-center w-14 h-14 rounded-full bg-gradient-to-br from-yellow-300 via-yellow-100 to-primary/20 shadow-xl border-4 border-yellow-400/30 animate-bounce">
                                <i class="lni lni-calculator text-3xl text-yellow-500 drop-shadow-lg"></i>
                            </span>
                            <div class="flex flex-col gap-1">
                                <h3 class="text-3xl lg:text-4xl font-extrabold bg-gradient-to-r from-primary via-yellow-500 to-secondary bg-clip-text text-transparent tracking-tight drop-shadow-lg leading-tight animate-fade-in-up">
                                    <span class="inline-flex items-center gap-2">
                                        <i class="lni lni-receipt text-yellow-400 text-3xl animate-bounce"></i>
                                        Order Summary
                                    </span>
                                </h3>
                                <p class="text-base text-gray-600 font-semibold mt-2 flex items-center gap-2 animate-fade-in">
                                    <i class="lni lni-checkmark-circle text-green-400"></i>
                                    Review your order details before checkout
                                </p>
                            </div>
                        </div>
                        <div class="space-y-7 divide-y divide-primary/10">
                            <!-- Subtotal -->
                            <div class="flex justify-between items-center py-3 animate-fade-in" style="animation-delay: .05s;">
                                <span class="text-gray-700 font-semibold flex items-center gap-2">
                                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 shadow">
                                        <i class="lni lni-cart text-primary text-lg"></i>
                                    </span>
                                    <span>Subtotal</span>
                                    <span class="text-xs text-gray-400 font-normal ml-1">(<span id="cart-items-count">{{ cart.get_cart_items_count }}</span> item{{ cart.get_cart_items_count|pluralize }})</span>
                                </span>
                                <span class="font-extrabold text-primary text-xl tracking-tight" id="cart-subtotal">
                                    ৳{{ cart.get_cart_total|floatformat:0|intcomma }}
                                </span>
                            </div>
                            <!-- Shipping -->
                            <div class="flex justify-between items-center py-3 animate-fade-in" style="animation-delay: .15s;">
                                <span class="text-gray-700 font-semibold flex items-center gap-2">
                                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 shadow">
                                        <i class="lni lni-delivery text-yellow-500 text-lg"></i>
                                    </span>
                                    <span>Shipping</span>
                                </span>
                                <span class="font-bold text-yellow-700 text-base" id="shipping-cost">
                                    {% if cart.get_cart_total > 10000 %}
                                    <span class="inline-flex items-center gap-1 bg-green-100 text-green-700 px-2 py-0.5 rounded-full animate-bounce shadow font-semibold">
                                        <i class="lni lni-gift"></i> Free
                                    </span>
                                    {% else %}
                                    <span class="inline-flex items-center gap-1 bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full animate-pulse-slow shadow font-semibold">
                                        ৳200
                                    </span>
                                    {% endif %}
                                </span>
                            </div>
                            <!-- Total -->
                            <div class="flex justify-between items-center py-5 animate-fade-in-up" style="animation-delay: .25s;">
                                <span class="text-2xl font-extrabold text-primary flex items-center gap-3 tracking-tight">
                                    <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-primary/10 shadow">
                                        <i class="lni lni-wallet text-primary text-2xl"></i>
                                    </span>
                                    <span>Total</span>
                                </span>
                                <span class="text-3xl font-black text-primary drop-shadow-sm flex items-center gap-2" id="cart-total">
                                    {% if cart.get_cart_total > 10000 %}
                                    ৳{{ cart.get_cart_total|floatformat:0|intcomma }}
                                    {% else %}
                                    ৳{{ cart.get_cart_total|add:200|floatformat:0|intcomma }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <a href="{% url 'checkout' %}" class="relative btn btn-primary w-full mt-10 flex items-center justify-center gap-3 px-8 py-4 text-lg font-extrabold rounded-2xl shadow-xl shadow-primary/20 hover:shadow-primary/40 hover:scale-105 transition-all duration-300 animate-fade-in-up overflow-hidden group" style="animation-delay: .35s;">
                            <!-- Animated glowing accent behind icon -->
                            <span class="absolute left-6 top-1/2 -translate-y-1/2 w-12 h-12 bg-gradient-to-br from-yellow-300/60 via-yellow-100/80 to-primary/30 rounded-full blur-2xl opacity-80 animate-pulse-slow z-0"></span>
                            <!-- Animated ring accent -->
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 w-8 h-8 border-4 border-yellow-400/40 rounded-full blur-md opacity-60 animate-float z-0"></span>
                            <!-- Icon -->
                            <span class="relative z-10 flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-br from-yellow-200 via-yellow-100 to-primary/20 shadow-md group-hover:bg-yellow-400/80 transition-all duration-300">
                                <i class="lni lni-credit-cards text-2xl text-primary group-hover:text-white transition-all duration-300"></i>
                            </span>
                            <span class="relative z-10 tracking-wide group-hover:text-white transition-all duration-300">
                                Proceed to Checkout
                            </span>
                            <!-- Right arrow accent -->
                            <span class="relative z-10 ml-2 flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 group-hover:bg-primary transition-all duration-300">
                                <i class="lni lni-arrow-right text-xl text-primary group-hover:text-white transition-all duration-300 animate-bounce"></i>
                            </span>
                        </a>
                        <div class="flex items-center justify-center gap-5 mt-8 animate-fade-in" style="animation-delay: .45s;">
                            <!-- Visa SVG -->
                            <span class="inline-flex items-center justify-center h-10 w-14 rounded-xl bg-white shadow border border-gray-100 grayscale hover:grayscale-0 transition-all duration-300 animate-float" style="animation-delay: .1s;">
                                <svg viewBox="0 0 48 32" width="48" height="32" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7">
                                    <rect width="48" height="32" rx="6" fill="#fff"/>
                                    <text x="24" y="22" text-anchor="middle" font-size="18" font-family="Arial Black, Arial, sans-serif" fill="#1A1F71" letter-spacing="2">VISA</text>
                                </svg>
                            </span>
                            <!-- Mastercard SVG -->
                            <span class="inline-flex items-center justify-center h-10 w-14 rounded-xl bg-white shadow border border-gray-100 grayscale hover:grayscale-0 transition-all duration-300 animate-float" style="animation-delay: .2s;">
                                <svg viewBox="0 0 48 32" width="48" height="32" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7">
                                    <rect width="48" height="32" rx="6" fill="#fff"/>
                                    <circle cx="19" cy="16" r="8" fill="#EB001B"/>
                                    <circle cx="29" cy="16" r="8" fill="#F79E1B"/>
                                    <circle cx="24" cy="16" r="8" fill="#FF5F00" fill-opacity="0.7"/>
                                </svg>
                            </span>
                            <!-- bKash SVG -->
                            <span class="inline-flex items-center justify-center h-10 w-14 rounded-xl bg-white shadow border border-gray-100 grayscale hover:grayscale-0 transition-all duration-300 animate-float" style="animation-delay: .3s;">
                                <svg viewBox="0 0 48 32" width="48" height="32" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7">
                                    <rect width="48" height="32" rx="6" fill="#fff"/>
                                    <g>
                                        <polygon points="12,24 24,8 36,24" fill="#E2136E"/>
                                        <polygon points="24,8 28,24 36,24" fill="#F9A9DD"/>
                                        <polygon points="12,24 20,24 24,8" fill="#B9006E"/>
                                    </g>
                                    <text x="24" y="29" text-anchor="middle" font-size="8" font-family="Arial Black, Arial, sans-serif" fill="#E2136E">bKash</text>
                                </svg>
                            </span>
                            <!-- Nagad SVG -->
                            <span class="inline-flex items-center justify-center h-10 w-14 rounded-xl bg-white shadow border border-gray-100 grayscale hover:grayscale-0 transition-all duration-300 animate-float" style="animation-delay: .4s;">
                                <svg viewBox="0 0 48 32" width="48" height="32" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7">
                                    <rect width="48" height="32" rx="6" fill="#fff"/>
                                    <circle cx="24" cy="16" r="10" fill="#F58220"/>
                                    <path d="M24 8v8l6 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <text x="24" y="29" text-anchor="middle" font-size="8" font-family="Arial Black, Arial, sans-serif" fill="#F58220">Nagad</text>
                                </svg>
                            </span>
                        </div>
                        <div class="mt-8 flex flex-col items-center justify-center animate-fade-in" style="animation-delay: .55s;">
                            <div class="relative flex items-center justify-center mb-2"></div>
                            <span class="inline-flex items-center gap-2 text-sm text-green-700 font-semibold bg-green-50 px-4 py-2 rounded-full shadow border border-green-100">
                                <i class="lni lni-lock-alt text-green-400"></i>
                                Secure &amp; Encrypted Checkout
                            </span>
                            <span class="mt-2 text-xs text-gray-400 font-medium flex items-center gap-1">
                                <i class="lni lni-checkmark-circle text-green-400"></i>
                                Your payment and personal information are protected.
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="py-24 flex flex-col items-center justify-center relative animate-fade-in-up">
                <!-- Animated glowing orb background -->
                <div class="absolute -top-24 left-1/2 -translate-x-1/2 w-80 h-80 bg-gradient-to-br from-yellow-200/40 via-primary/20 to-secondary/10 rounded-full blur-[120px] opacity-70 z-0"></div>
                <!-- Empty cart icon with glass effect and bounce -->
                <div class="relative z-10 bg-gradient-to-br from-white via-yellow-50 to-primary/10 p-8 rounded-full shadow-2xl border-4 border-yellow-100 mb-6 glass-shimmer animate-bounce">
                    <i class="lni lni-cart text-6xl text-yellow-400 drop-shadow-lg"></i>
                </div>
                <h3 class="relative z-10 text-3xl md:text-4xl font-extrabold text-primary mb-3 bg-gradient-to-r from-primary via-yellow-500 to-secondary bg-clip-text text-transparent drop-shadow-xl animate-fade-in-up tracking-tight">
                    Your Cart is Empty
                </h3>
                <p class="relative z-10 text-gray-500 max-w-lg mx-auto mb-8 text-lg font-medium animate-fade-in">
                    Looks like you haven't added any products yet.<br>
                    Discover amazing deals and start shopping now!
                </p>
                <a href="{% url 'product-list' %}" class="relative z-10 inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-primary/80 via-yellow-400 to-secondary/80 text-primary text-lg font-extrabold rounded-2xl shadow-xl shadow-primary/20 hover:shadow-primary/40 hover:scale-105 transition-all duration-300 group animate-fade-in-up">
                    <span class="flex items-center justify-center w-10 h-10 rounded-full bg-yellow-100 group-hover:bg-primary group-hover:text-white transition-all duration-300">
                        <i class="lni lni-shopping-basket text-2xl group-hover:animate-bounce text-primary group-hover:text-white"></i>
                    </span>
                    <span class="tracking-wide group-hover:text-white transition-all duration-300">
                        Start Shopping
                    </span>
                    <span class="flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 group-hover:bg-primary transition-all duration-300">
                        <i class="lni lni-arrow-right text-xl text-primary group-hover:text-white transition-all duration-300 animate-bounce"></i>
                    </span>
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Toast Notification Container -->
<div id="toast-container" class="fixed bottom-4 right-4 z-50"></div>

<!-- Add JavaScript for dynamic cart updates -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get CSRF token
        const csrfToken = '{{ csrf_token }}';

        // Recalculate totals on page load to ensure consistency
        calculateAndUpdateTotals();

        // This function calculates the correct totals based on the current cart state
        function calculateAndUpdateTotals() {
            // Get the subtotal directly from the template context
            const subtotal = parseFloat('{{ cart.get_cart_total }}');

            // Determine shipping cost
            let shippingCost = 200;
            let shippingText = `৳200`;

            if (subtotal > 10000) {
                shippingCost = 0;
                shippingText = 'Free';
            }

            // Calculate grand total
            const grandTotal = subtotal + shippingCost;

            // Format numbers with commas
            const formattedSubtotal = numberWithCommas(Math.round(subtotal));
            const formattedGrandTotal = numberWithCommas(Math.round(grandTotal));

            // Update DOM elements
            document.getElementById('cart-subtotal').textContent = `৳${formattedSubtotal}`;
            document.getElementById('shipping-cost').textContent = shippingText;
            document.getElementById('cart-total').textContent = `৳${formattedGrandTotal}`;
        }

        // Update quantity using AJAX
        function updateCartItem(itemId, quantity) {
            fetch('{% url "update_cart" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: `item_id=${itemId}&quantity=${quantity}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Update item total
                    const itemTotalElement = document.querySelector(`.item-total[data-item-id="${itemId}"]`);
                    if (itemTotalElement) {
                        itemTotalElement.textContent = `৳${numberWithCommas(Math.round(data.item_total))}`;
                    }

                    // Update cart summary
                    updateCartSummary(data);

                    // Show success message
                    showToast('Cart updated successfully', 'success');
                } else {
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error updating cart:', error);
                showToast('Failed to update cart. Please try again.', 'error');
            });
        }

        // Remove item from cart using AJAX
        function removeCartItem(itemId) {
            fetch('{% url "remove_from_cart" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: `item_id=${itemId}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Remove item row from table
                    const itemRow = document.getElementById(`cart-item-${itemId}`);
                    if (itemRow) {
                        itemRow.remove();
                    }

                    // Update cart summary
                    updateCartSummary(data);

                    // Show success message
                    showToast('Item removed from cart', 'success');

                    // Check if cart is empty and reload page if needed
                    if (data.cart_count === 0) {
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                } else {
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error removing item:', error);
                showToast('Failed to remove item. Please try again.', 'error');
            });
        }

        // Update cart summary elements
        function updateCartSummary(data) {
            // Get the cart total
            const cartTotal = parseFloat(data.cart_total);

            // Determine shipping cost
            let shippingCost = 200;
            let shippingText = `৳200`;

            if (cartTotal > 10000) {
                shippingCost = 0;
                shippingText = 'Free';
            }

            // Calculate grand total
            const grandTotal = cartTotal + shippingCost;

            // Format numbers with commas
            const formattedSubtotal = numberWithCommas(Math.round(cartTotal));
            const formattedGrandTotal = numberWithCommas(Math.round(grandTotal));

            // Update DOM elements
            document.getElementById('cart-subtotal').textContent = `৳${formattedSubtotal}`;
            document.getElementById('cart-items-count').textContent = data.cart_count;
            document.getElementById('shipping-cost').textContent = shippingText;
            document.getElementById('cart-total').textContent = `৳${formattedGrandTotal}`;

            // Update any header cart counts
            const headerCartCounts = document.querySelectorAll('.cart-count');
            headerCartCounts.forEach(element => {
                element.textContent = data.cart_count;
            });
        }

        // Format number with commas
        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');

            // Set the appropriate classes based on type
            let bgColor = 'bg-green-600';
            let icon = 'lni-checkmark-circle';

            if (type === 'error') {
                bgColor = 'bg-red-600';
                icon = 'lni-warning';
            }

            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg flex items-center mb-2 transform transition-all duration-300 ease-in-out`;
            toast.innerHTML = `
                <i class="lni ${icon} text-xl mr-2"></i>
                <span>${message}</span>
            `;

            // Add to toast container
            const toastContainer = document.getElementById('toast-container');
            toastContainer.appendChild(toast);

            // Animate in
            setTimeout(() => toast.classList.add('translate-y-0', 'opacity-100'), 10);
            toast.classList.add('translate-y-2', 'opacity-0');

            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-y-2', 'opacity-0');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Quantity button event listeners
        const quantityBtns = document.querySelectorAll('.quantity-btn');
        quantityBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const itemId = this.getAttribute('data-item-id');
                const action = this.getAttribute('data-action');
                const input = document.querySelector(`.quantity-input[data-item-id="${itemId}"]`);

                let quantity = parseInt(input.value);

                if (action === 'increase') {
                    quantity += 1;
                } else if (action === 'decrease') {
                    quantity = Math.max(1, quantity - 1);
                }

                // Update input value
                input.value = quantity;

                // Update cart via AJAX
                updateCartItem(itemId, quantity);
            });
        });

        // Quantity input change event
        const quantityInputs = document.querySelectorAll('.quantity-input');
        quantityInputs.forEach(input => {
            input.addEventListener('change', function() {
                const itemId = this.getAttribute('data-item-id');
                let quantity = parseInt(this.value);

                // Ensure quantity is at least 1
                quantity = Math.max(1, quantity);
                this.value = quantity;

                // Update cart via AJAX
                updateCartItem(itemId, quantity);
            });
        });

        // Remove button event listeners
        const removeBtns = document.querySelectorAll('.remove-item-btn');
        removeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const itemId = this.getAttribute('data-item-id');

                // Ask for confirmation
                if (confirm('Are you sure you want to remove this item from your cart?')) {
                    removeCartItem(itemId);
                }
            });
        });
    });
</script>
{% endblock content %}