{% extends "base.html" %}
{% load static %}
{% block title %}User Management - TechReform BD{% endblock %}
{% block content %}

<!-- User Management Section -->
<section class="py-20 bg-base-100 overflow-hidden min-h-screen relative">
    <div class="container mx-auto px-4 relative z-10">
        <!-- Enhanced background elements -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-primary/30 to-primary/10 rounded-full filter blur-3xl animate-pulse" style="animation-duration: 10s;"></div>
            <div class="absolute top-1/2 -left-40 w-96 h-96 bg-gradient-to-tr from-secondary/30 to-secondary/10 rounded-full filter blur-3xl animate-pulse" style="animation-duration: 14s; animation-delay: 2s;"></div>
            <div class="absolute bottom-20 right-1/4 w-72 h-72 bg-gradient-to-bl from-primary/20 to-secondary/20 rounded-full filter blur-2xl animate-pulse" style="animation-duration: 12s; animation-delay: 1s;"></div>
            <div class="hidden md:block absolute top-40 left-1/4 w-48 h-48 bg-accent/20 rounded-full filter blur-xl"></div>
            <!-- Improved grid pattern overlay with gradient -->
            <div class="absolute inset-0 bg-grid-pattern opacity-[0.07] mix-blend-overlay"></div>
            <!-- Abstract shapes -->
            <div class="absolute top-1/3 right-1/4 w-24 h-24 border border-primary/30 rounded-xl rotate-12 opacity-60"></div>
            <div class="absolute bottom-1/4 left-1/3 w-20 h-20 border border-secondary/30 rounded-full opacity-60"></div>
        </div>

        <!-- Section heading with enhanced design -->
        <div class="text-center mb-12 relative z-10">
            <!-- Premium badge with advanced styling -->
            <div class="inline-flex items-center justify-center">
            <span class="bg-gradient-to-r from-primary/20 to-secondary/20 text-primary font-medium py-2.5 px-7 rounded-full text-sm mb-5 inline-flex items-center shadow-lg shadow-primary/10 backdrop-blur-md border border-primary/30 relative overflow-hidden group">
                <span class="absolute inset-0 bg-gradient-to-r from-primary/10 to-secondary/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                <i class="fas fa-shield-alt mr-2.5 text-primary/90"></i>
                <span class="font-semibold tracking-wide">ADMIN CONTROL PANEL</span>
            </span>
            </div>

            <!-- Enhanced title with modern 3D and gradient effects -->
            <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-3 tracking-tight relative">
                <span class="relative inline-block">
                    <!-- Enhanced multi-layer shadow for deeper 3D effect -->
                    <span class="absolute -left-0.5 -top-0.5 bg-gradient-to-br from-primary/30 via-secondary/30 to-accent/30 bg-clip-text text-transparent blur-sm">
                        User Management
                    </span>
                    <span class="absolute -left-1 -top-1 bg-gradient-to-tl from-primary/20 via-accent/20 to-secondary/20 bg-clip-text text-transparent blur-md">
                        User Management
                    </span>
                    <!-- Main text with smoother animated gradient -->
                    <span class="bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent inline-block animate-gradient-x relative">
                        User Management
                    </span>
                    <!-- Enhanced highlights -->
                    <span class="absolute -right-0.5 -bottom-0.5 bg-gradient-to-tr from-white/10 to-transparent bg-clip-text text-transparent">
                        User Management
                    </span>
                    <!-- Subtle glow effect -->
                    <span class="absolute inset-0 bg-white/5 blur-xl opacity-30 rounded-full"></span>
                </span>
            </h2>

            <!-- Enhanced subtitle with gradient and animation -->
            <p class="text-base-content/70 max-w-3xl mx-auto mb-8 text-lg relative group">
                <span class="inline-block relative">
                    <span class="absolute -left-1 -top-1 blur-sm opacity-30 text-primary/40">Manage user roles and permissions efficiently</span>
                    <span class="relative inline-block">
                        Manage user roles and permissions
                        <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent font-medium">efficiently</span>
                        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-primary to-secondary group-hover:w-full transition-all duration-500 opacity-70"></span>
                    </span>
                </span>
                <span class="absolute -top-6 -right-10 w-10 h-10 bg-primary/10 rounded-full blur-xl animate-pulse hidden md:block"></span>
            </p>

            <!-- Enhanced animated divider with improved visual appeal -->
            <div class="flex items-center justify-center gap-3 my-6 relative">
                <!-- Left side decorative elements -->
                <div class="flex items-center space-x-1.5">
                    <div class="w-1.5 h-1.5 bg-primary/80 rounded-full animate-ping opacity-75" style="animation-duration: 4s;"></div>
                    <div class="w-16 h-1.5 bg-gradient-to-r from-primary/20 to-primary/80 rounded-full animate-pulse" style="animation-duration: 3.5s;"></div>
                </div>

                <!-- Central glowing divider -->
                <div class="w-32 h-2.5 bg-gradient-to-r from-primary via-accent to-secondary rounded-full relative overflow-hidden">
                    <div class="absolute inset-0 bg-white/20 rounded-full blur-sm"></div>
                    <div class="absolute inset-0 w-1/2 bg-white/30 rounded-full animate-shimmer"></div>
                    <div class="absolute -bottom-1 w-full h-1.5 bg-gradient-to-r from-primary/40 to-secondary/40 blur-md"></div>
                    <div class="absolute top-0 left-0 w-full h-full bg-grid-pattern opacity-30"></div>
                </div>

                <!-- Right side decorative elements -->
                <div class="flex items-center space-x-1.5">
                    <div class="w-16 h-1.5 bg-gradient-to-l from-secondary/20 to-secondary/80 rounded-full animate-pulse" style="animation-duration: 3.5s; animation-delay: 0.7s;"></div>
                    <div class="w-1.5 h-1.5 bg-secondary/80 rounded-full animate-ping opacity-75" style="animation-duration: 4s; animation-delay: 1s;"></div>
                </div>

                <!-- Floating decorative particles -->
                <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-primary/80 rounded-full shadow-lg shadow-primary/50"></div>
                <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-secondary/80 rounded-full shadow-lg shadow-secondary/50"></div>
            </div>
        </div>

        <!-- Enhanced User Statistics Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12 max-w-6xl mx-auto">
            <!-- Total Users Card -->
            <div class="card bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20 shadow-lg hover:shadow-xl hover:shadow-primary/20 transition-all duration-300 group">
                <div class="card-body p-6 relative overflow-hidden">
                    <div class="absolute -top-4 -right-4 w-16 h-16 bg-primary/10 rounded-full blur-xl animate-pulse"></div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-users text-primary text-xl"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-3xl font-bold text-primary">{{ users|length|default:"0" }}</p>
                            <p class="text-sm text-base-content/60">Total Users</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                        <span class="badge badge-success badge-sm">
                            <i class="fas fa-arrow-up mr-1"></i>
                            +12%
                        </span>
                        <span class="text-base-content/60">vs last month</span>
                    </div>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-primary/30 to-primary/60"></div>
                </div>
            </div>

            <!-- Active Admins Card -->
            <div class="card bg-gradient-to-br from-secondary/10 to-secondary/5 border border-secondary/20 shadow-lg hover:shadow-xl hover:shadow-secondary/20 transition-all duration-300 group">
                <div class="card-body p-6 relative overflow-hidden">
                    <div class="absolute -top-4 -right-4 w-16 h-16 bg-secondary/10 rounded-full blur-xl animate-pulse"></div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-shield-alt text-secondary text-xl"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-3xl font-bold text-secondary">3</p>
                            <p class="text-sm text-base-content/60">Admin Users</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                        <span class="badge badge-info badge-sm">
                            <i class="fas fa-check mr-1"></i>
                            All Active
                        </span>
                        <span class="text-base-content/60">Last 24h</span>
                    </div>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-secondary/30 to-secondary/60"></div>
                </div>
            </div>

            <!-- New Registrations Card -->
            <div class="card bg-gradient-to-br from-accent/10 to-accent/5 border border-accent/20 shadow-lg hover:shadow-xl hover:shadow-accent/20 transition-all duration-300 group">
                <div class="card-body p-6 relative overflow-hidden">
                    <div class="absolute -top-4 -right-4 w-16 h-16 bg-accent/10 rounded-full blur-xl animate-pulse"></div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-user-plus text-accent text-xl"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-3xl font-bold text-accent">24</p>
                            <p class="text-sm text-base-content/60">This Month</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                        <span class="badge badge-warning badge-sm">
                            <i class="fas fa-clock mr-1"></i>
                            5 Today
                        </span>
                        <span class="text-base-content/60">New signups</span>
                    </div>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-accent/30 to-accent/60"></div>
                </div>
            </div>

            <!-- System Health Card -->
            <div class="card bg-gradient-to-br from-success/10 to-success/5 border border-success/20 shadow-lg hover:shadow-xl hover:shadow-success/20 transition-all duration-300 group">
                <div class="card-body p-6 relative overflow-hidden">
                    <div class="absolute -top-4 -right-4 w-16 h-16 bg-success/10 rounded-full blur-xl animate-pulse"></div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-success/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <i class="fas fa-heartbeat text-success text-xl"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-3xl font-bold text-success">98%</p>
                            <p class="text-sm text-base-content/60">System Health</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                        <span class="badge badge-success badge-sm">
                            <i class="fas fa-check-circle mr-1"></i>
                            Optimal
                        </span>
                        <span class="text-base-content/60">All systems</span>
                    </div>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-success/30 to-success/60"></div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Bar -->
        <div class="bg-base-200/50 backdrop-blur-md rounded-2xl p-6 mb-8 max-w-6xl mx-auto border border-base-300/30 shadow-lg">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <h3 class="text-lg font-semibold text-base-content/90 flex items-center gap-2">
                        <i class="fas fa-bolt text-primary"></i>
                        Quick Actions
                    </h3>
                    <div class="badge badge-primary badge-sm">Management Tools</div>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                    <button class="btn btn-sm btn-primary gap-2 group relative overflow-hidden">
                        <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></span>
                        <i class="fas fa-user-plus relative z-10"></i>
                        <span class="relative z-10">Add User</span>
                    </button>
                    <button class="btn btn-sm btn-secondary gap-2 group relative overflow-hidden">
                        <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></span>
                        <i class="fas fa-download relative z-10"></i>
                        <span class="relative z-10">Export Data</span>
                    </button>
                    <button class="btn btn-sm btn-accent gap-2 group relative overflow-hidden">
                        <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></span>
                        <i class="fas fa-envelope relative z-10"></i>
                        <span class="relative z-10">Bulk Email</span>
                    </button>
                    <div class="dropdown dropdown-end">
                        <label tabindex="0" class="btn btn-sm btn-ghost gap-2">
                            <i class="fas fa-ellipsis-h"></i>
                            More
                        </label>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow-xl bg-base-100 rounded-box w-48">
                            <li><a class="flex items-center gap-2"><i class="fas fa-chart-bar text-info"></i>Analytics</a></li>
                            <li><a class="flex items-center gap-2"><i class="fas fa-cogs text-warning"></i>Settings</a></li>
                            <li><a class="flex items-center gap-2"><i class="fas fa-history text-secondary"></i>Activity Log</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management Table -->
        <div class="card bg-base-100/80 shadow-2xl overflow-hidden backdrop-blur-md border border-base-300/50 max-w-6xl mx-auto transition-all duration-300 hover:shadow-primary/10 hover:border-primary/30 group">
            <div class="card-body p-0">
            <!-- Enhanced search and filter toolbar with improved visuals -->
            <div class="bg-gradient-to-r from-base-200/60 to-base-200/40 p-6 border-b border-base-300/50 flex flex-wrap items-center justify-between gap-4 relative overflow-hidden">
                <!-- Subtle decorative elements -->
                <div class="absolute -bottom-12 -right-12 w-32 h-32 bg-primary/5 rounded-full blur-xl animate-pulse" style="animation-duration: 15s;"></div>
                <div class="absolute -top-8 -left-8 w-24 h-24 bg-secondary/5 rounded-full blur-xl animate-pulse" style="animation-duration: 18s;"></div>
                <div class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-primary/30 via-accent/20 to-secondary/30"></div>
                <div class="absolute bottom-0 right-0 w-1/3 h-0.5 bg-gradient-to-l from-primary/20 to-transparent"></div>

                <!-- Improved search input with animation and glow effect -->
                <div class="relative group/search flex-grow max-w-md">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary/10 via-accent/10 to-secondary/10 rounded-xl blur opacity-0 group-focus-within/search:opacity-100 transition-opacity duration-500"></div>
                    <div class="relative flex items-center">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-base-content/50 group-focus-within/search:text-primary transition-colors duration-300 z-10"></i>
                        <input type="text" placeholder="Search by name, email or role..."
                            class="input input-bordered w-full pl-11 pr-10 py-2 bg-base-100/90 border-base-300/40 focus:border-primary/60 focus:outline-none relative z-10 transition-all duration-300 focus:shadow-lg focus:shadow-primary/15 rounded-xl">
                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 z-10 opacity-0 group-focus-within/search:opacity-100 transition-opacity">
                            <kbd class="kbd kbd-sm bg-base-200/80 text-xs font-light">Enter</kbd>
                        </span>
                        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-primary to-secondary group-focus-within/search:w-full transition-all duration-500"></span>
                    </div>                </div>

                <div class="flex flex-wrap items-center gap-4 text-sm">
                    <!-- Enhanced filter dropdown with improved hover states -->
                    <div class="dropdown dropdown-top dropdown-end">
                        <label tabindex="0" class="btn btn-sm border-base-300/50 bg-base-100/90 hover:bg-primary/10 hover:border-primary/30 transition-all flex items-center gap-2 group shadow-sm hover:shadow">
                            <i class="fas fa-filter text-xs group-hover:text-primary transition-colors"></i>
                            <span>Filter</span>
                            <i class="fas fa-chevron-down text-xs opacity-60 group-hover:translate-y-0.5 transition-transform duration-300"></i>
                        </label>
                        <ul tabindex="0" class="dropdown-content z-[100] menu p-3 shadow-xl bg-base-100/95 rounded-xl w-56 border border-base-300/30 backdrop-blur-lg mt-1">
                            <li class="menu-title text-xs font-medium text-base-content/60 pb-1">Filter by role</li>
                            <li><a class="flex items-center gap-2 active:bg-primary/10 hover:bg-base-200/70"><i class="fas fa-users text-xs"></i> All Roles</a></li>
                            <li><a class="flex items-center gap-2 active:bg-primary/10 hover:bg-base-200/70"><i class="fas fa-shield-alt text-xs text-primary"></i> Admin</a></li>
                            <li><a class="flex items-center gap-2 active:bg-primary/10 hover:bg-base-200/70"><i class="fas fa-user-tie text-xs text-secondary"></i> Staff</a></li>
                            <li><a class="flex items-center gap-2 active:bg-primary/10 hover:bg-base-200/70"><i class="fas fa-pen text-xs text-accent"></i> Content Manager</a></li>
                            <div class="border-t border-base-300/30 my-1"></div>
                            <li><a class="flex items-center gap-2 active:bg-primary/10 text-xs hover:bg-base-200/70"><i class="fas fa-calendar-alt"></i> Sort by join date</li>
                        </ul>
                    </div>

                    <!-- Enhanced add user button with animation and glow effect -->
                    <button class="btn btn-sm btn-primary gap-2 group relative overflow-hidden shadow-md">
                        <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></span>
                        <span class="absolute -inset-1 bg-primary/30 blur-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg"></span>
                        <span class="relative z-10 flex items-center gap-1.5">
                            <i class="fas fa-plus text-xs group-hover:rotate-90 transition-transform duration-300"></i>
                            <span>Add User</span>
                        </span>
                    </button>                    <!-- Quick action menu with improved styling -->
                    <div class="dropdown dropdown-top dropdown-end">
                        <label tabindex="0" class="btn btn-sm btn-ghost btn-circle hover:bg-base-200/90 shadow-sm">
                            <i class="fas fa-ellipsis-v"></i>
                        </label>
                        <ul tabindex="0" class="dropdown-content z-[100] menu p-2 shadow-xl bg-base-100/95 rounded-box w-48 border border-base-300/30 backdrop-blur-lg">
                            <li><a class="text-xs hover:bg-base-200/70 flex items-center"><i class="fas fa-file-export mr-2 text-primary/80"></i> Export users</a></li>
                            <li><a class="text-xs hover:bg-base-200/70 flex items-center"><i class="fas fa-cog mr-2 text-secondary/80"></i> Settings</a></li>
                        </ul>
                    </div>
                </div>
            </div>            <div class="overflow-x-auto relative">
                <table class="table w-full">
                    <thead>
                        <tr class="bg-gradient-to-r from-base-200/70 via-base-200/50 to-base-200/30 text-base-content/80 border-b border-base-300/30">                            <th class="font-medium uppercase text-xs tracking-wider py-5 px-6 first:rounded-tl-xl">
                                <div class="flex items-center gap-2 group cursor-pointer hover:text-primary transition-colors duration-200" data-sort="username">
                                    <span>Username</span>
                                    <div class="bg-base-300/50 p-1 rounded-md group-hover:bg-primary/20 transition-colors">
                                        <i class="fas fa-sort text-[0.6rem] opacity-60 group-hover:opacity-100"></i>
                                    </div>
                                    <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary/50 group-hover:w-full transition-all duration-300 opacity-0 group-hover:opacity-100"></div>
                                </div>
                            </th>
                            <th class="font-medium uppercase text-xs tracking-wider py-5">
                                <div class="flex items-center gap-2 group cursor-pointer hover:text-primary transition-colors duration-200" data-sort="name">
                                    <span>Name</span>
                                    <div class="bg-base-300/50 p-1 rounded-md group-hover:bg-primary/20 transition-colors">
                                        <i class="fas fa-sort text-[0.6rem] opacity-60 group-hover:opacity-100"></i>
                                    </div>
                                </div>
                            </th>
                            <th class="font-medium uppercase text-xs tracking-wider py-5">
                                <div class="flex items-center gap-2 group cursor-pointer hover:text-primary transition-colors duration-200" data-sort="email">
                                    <span>Email</span>
                                    <div class="bg-base-300/50 p-1 rounded-md group-hover:bg-primary/20 transition-colors">
                                        <i class="fas fa-sort text-[0.6rem] opacity-60 group-hover:opacity-100"></i>
                                    </div>
                                </div>
                            </th>
                            <th class="font-medium uppercase text-xs tracking-wider py-5">
                                <div class="flex items-center gap-2 group cursor-pointer hover:text-primary transition-colors duration-200" data-sort="role">
                                    <span>Role</span>
                                    <div class="bg-base-300/50 p-1 rounded-md group-hover:bg-primary/20 transition-colors">
                                        <i class="fas fa-sort text-[0.6rem] opacity-60 group-hover:opacity-100"></i>
                                    </div>
                                </div>
                            </th>
                            <th class="font-medium uppercase text-xs tracking-wider py-5">
                                <div class="flex items-center gap-2 group cursor-pointer hover:text-primary transition-colors duration-200" data-sort="joined">
                                    <span>Joined</span>
                                    <div class="bg-base-300/50 p-1 rounded-md group-hover:bg-primary/20 transition-colors">
                                        <i class="fas fa-sort text-[0.6rem] opacity-60 group-hover:opacity-100"></i>
                                    </div>
                                </div>
                            </th>
                            <th class="font-medium uppercase text-xs tracking-wider text-right py-5 px-6 last:rounded-tr-xl">
                                <span class="inline-flex items-center gap-2">
                                    <span>Actions</span>
                                    <div class="tooltip tooltip-left" data-tip="Manage user settings">
                                        <i class="fas fa-info-circle text-xs opacity-50"></i>
                                    </div>
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-base-200/40">
                        {% for user in users %}
                        <tr class="hover:bg-base-200/30 border-b border-base-200/40 transition-all duration-200 group/row">
                            <td class="py-4 px-6">
                                <div class="flex items-center gap-3">
                                    <div class="avatar relative group/avatar">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary/40 via-primary/20 to-secondary/30 flex items-center justify-center overflow-hidden border border-primary/30 group-hover/row:border-primary/60 transition-all shadow-md group-hover/row:shadow-primary/30 relative">
                                            {% if user.profile.profile_image %}
                                                <img src="{{ user.profile.profile_image.url }}" alt="{{ user.username }}" class="object-cover w-full h-full">
                                            {% else %}
                                                <div class="absolute inset-0 flex items-center justify-center">
                                                    <span class="font-bold bg-gradient-to-br from-primary to-secondary bg-clip-text text-transparent text-lg group-hover/row:scale-110 transition-transform duration-300">{{ user.username|first|upper }}</span>
                                                </div>
                                                <div class="absolute inset-0 bg-white/5 animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity"></div>
                                            {% endif %}
                                        </div>
                                        <div class="absolute -bottom-1 -right-1 w-3.5 h-3.5 bg-success rounded-full border-2 border-base-100 shadow-sm opacity-0 group-hover/row:opacity-100 transition-opacity"></div>
                                    </div>
                                    <span class="font-medium group-hover/row:text-primary transition-colors">{{ user.username }}</span>
                                </div>
                            </td>
                            <td class="py-4">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-user-circle text-xs text-base-content/50 group-hover/row:text-secondary transition-colors"></i>
                                    {% if user.first_name or user.last_name %}
                                        <span class="font-medium group-hover/row:text-secondary transition-colors">{{ user.first_name }} {{ user.last_name }}</span>
                                    {% else %}
                                        <span class="text-base-content/50 italic text-sm group-hover/row:text-secondary/70 transition-colors">Not provided</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="py-4">
                                <div class="flex items-center gap-2 group/email relative">
                                    <div class="w-7 h-7 flex items-center justify-center rounded-full bg-primary/10 text-primary/70 group-hover/row:bg-primary/20 transition-all">
                                        <i class="fas fa-envelope text-xs"></i>
                                    </div>
                                    <div class="relative">
                                        <span class="group-hover/email:text-primary transition-colors">{{ user.email }}</span>
                                        <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-primary/60 to-secondary/60 group-hover/email:w-full transition-all duration-300"></div>
                                    </div>
                                    <button class="btn btn-xs btn-ghost btn-circle opacity-0 group-hover/email:opacity-100 transition-all duration-300 hover:bg-primary/10 hover:scale-110"
                                            onclick="navigator.clipboard.writeText('{{ user.email }}'); this.querySelector('.tooltip-content').classList.remove('hidden')">
                                        <i class="fas fa-copy text-xs"></i>
                                        <span class="tooltip-content hidden absolute -top-8 left-1/2 transform -translate-x-1/2 bg-base-100 text-xs py-1 px-2 rounded shadow-md whitespace-nowrap border border-base-300 z-10 animate-fade-in">
                                            Copied!
                                        </span>
                                    </button>
                                </div>
                            </td>
                            <td class="py-4">
                                {% if user.profile.role == 'admin' %}
                                <div class="flex items-center justify-start">
                                    <span class="badge badge-primary badge-sm gap-1.5 py-3 px-4 font-medium shadow-md shadow-primary/20 group-hover/row:scale-105 transition-all duration-300 relative overflow-hidden">
                                        <span class="absolute inset-0 bg-white/20 opacity-0 group-hover/row:opacity-100 animate-pulse transition-opacity" style="animation-duration: 2s;"></span>
                                        <i class="fas fa-shield-alt text-primary-content/90 group-hover/row:rotate-12 transition-transform duration-300"></i>
                                        <span class="relative z-10">{{ user.profile.get_role_display }}</span>
                                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-primary-content/30 scale-x-0 group-hover/row:scale-x-100 transition-transform duration-500 origin-left"></span>
                                    </span>
                                </div>
                                {% elif user.profile.role == 'staff' %}
                                <div class="flex items-center justify-start">
                                    <span class="badge badge-secondary badge-sm gap-1.5 py-3 px-4 font-medium shadow-md shadow-secondary/20 group-hover/row:scale-105 transition-all duration-300 relative overflow-hidden">
                                        <span class="absolute inset-0 bg-white/20 opacity-0 group-hover/row:opacity-100 animate-pulse transition-opacity" style="animation-duration: 2s;"></span>
                                        <i class="fas fa-user-tie text-secondary-content/90 group-hover/row:translate-y-[-2px] transition-transform duration-300"></i>
                                        <span class="relative z-10">{{ user.profile.get_role_display }}</span>
                                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-secondary-content/30 scale-x-0 group-hover/row:scale-x-100 transition-transform duration-500 origin-left"></span>
                                    </span>
                                </div>
                                {% elif user.profile.role == 'content_manager' %}
                                <div class="flex items-center justify-start">
                                    <span class="badge badge-accent badge-sm gap-1.5 py-3 px-4 font-medium shadow-md shadow-accent/20 group-hover/row:scale-105 transition-all duration-300 relative overflow-hidden">
                                        <span class="absolute inset-0 bg-white/20 opacity-0 group-hover/row:opacity-100 animate-pulse transition-opacity" style="animation-duration: 2s;"></span>
                                        <i class="fas fa-pen text-accent-content/90 group-hover/row:rotate-[-12deg] transition-transform duration-300"></i>
                                        <span class="relative z-10">{{ user.profile.get_role_display }}</span>
                                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-accent-content/30 scale-x-0 group-hover/row:scale-x-100 transition-transform duration-500 origin-left"></span>
                                    </span>
                                </div>
                                {% elif user.profile.role == 'blogger' %}
                                <div class="flex items-center justify-start">
                                    <span class="badge bg-info/80 text-info-content badge-sm gap-1.5 py-3 px-4 font-medium shadow-md shadow-info/20 group-hover/row:scale-105 transition-all duration-300 relative overflow-hidden">
                                        <span class="absolute inset-0 bg-white/20 opacity-0 group-hover/row:opacity-100 animate-pulse transition-opacity" style="animation-duration: 2s;"></span>
                                        <i class="fas fa-feather-alt text-info-content/90 group-hover/row:rotate-12 transition-transform duration-300"></i>
                                        <span class="relative z-10">{{ user.profile.get_role_display }}</span>
                                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-info-content/30 scale-x-0 group-hover/row:scale-x-100 transition-transform duration-500 origin-left"></span>
                                    </span>
                                </div>
                                {% else %}
                                <div class="flex items-center justify-start">
                                    <span class="badge bg-base-200 text-base-content/80 badge-sm gap-1.5 py-3 px-4 font-medium border border-base-300 group-hover/row:bg-base-300/70 transition-all duration-300 group-hover/row:scale-105 relative overflow-hidden">
                                        <span class="absolute inset-0 bg-base-content/5 opacity-0 group-hover/row:opacity-100 transition-opacity"></span>
                                        <i class="fas fa-user text-base-content/70 group-hover/row:text-base-content transition-colors duration-300"></i>
                                        <span class="relative z-10">{{ user.profile.get_role_display }}</span>
                                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-base-content/20 scale-x-0 group-hover/row:scale-x-100 transition-transform duration-500 origin-left"></span>
                                    </span>
                                </div>
                                {% endif %}
                            </td>
                            <td class="py-4">
                                <div class="flex items-center gap-2 group/date relative">
                                    <div class="w-7 h-7 flex items-center justify-center rounded-full bg-secondary/10 text-secondary/70 group-hover/row:bg-secondary/20 transition-all">
                                        <i class="fas fa-calendar-alt text-xs group-hover/date:scale-110 transition-transform duration-300"></i>
                                    </div>
                                    <div class="relative">
                                        <span class="group-hover/date:text-secondary transition-colors">{{ user.date_joined|date:"M d, Y" }}</span>
                                        <span class="text-xs text-base-content/40 block group-hover/date:text-secondary/70 transition-colors">{{ user.date_joined|timesince }} ago</span>
                                        <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-secondary/60 to-primary/60 group-hover/date:w-full transition-all duration-300"></div>
                                    </div>
                                    <div class="tooltip tooltip-left absolute -right-4 opacity-0 group-hover/date:opacity-100 transition-opacity duration-200" data-tip="Joined on {{ user.date_joined|date:'F d, Y H:i' }}">
                                        <i class="fas fa-info-circle text-xs text-base-content/40"></i>
                                    </div>
                                </div>
                            </td>
                            <td class="py-4 px-6 text-right">                                <div class="flex justify-end space-x-3 items-center">
                                    <!-- Change Role Button -->
                                    <button onclick="document.getElementById('modal-change-role-{{ user.id }}').showModal()"
                                            class="btn btn-xs bg-primary/10 hover:bg-primary/30 text-primary border-primary/20 hover:border-primary/50 btn-square group/btn relative overflow-hidden shadow-sm hover:shadow-primary/30 transition-all duration-300"
                                            title="Change Role">
                                        <span class="absolute inset-0 bg-gradient-to-br from-primary/20 to-primary/5 transform scale-0 group-hover/btn:scale-100 rounded-md transition-transform duration-300 origin-center"></span>
                                        <i class="fas fa-user-tag relative z-10 group-hover/btn:scale-110 group-hover/btn:rotate-6 transition-all duration-300"></i>
                                        <span class="sr-only">Change Role</span>
                                    </button>

                                    <!-- Delete User Button -->
                                    <button onclick="document.getElementById('modal-delete-user-{{ user.id }}').showModal()"
                                            class="btn btn-xs bg-error/10 hover:bg-error/30 text-error border-error/20 hover:border-error/50 btn-square group/btn relative overflow-hidden shadow-sm hover:shadow-error/30 transition-all duration-300"
                                            title="Delete User">
                                        <span class="absolute inset-0 bg-gradient-to-br from-error/20 to-error/5 transform scale-0 group-hover/btn:scale-100 rounded-md transition-transform duration-300 origin-center"></span>
                                        <i class="fas fa-trash-alt relative z-10 group-hover/btn:scale-110 group-hover/btn:rotate-6 transition-all duration-300"></i>
                                        <span class="sr-only">Delete User</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-10">
                            <div class="flex flex-col items-center justify-center">
                                <i class="fas fa-users-slash text-5xl text-base-content/30 mb-4"></i>
                                <p class="text-xl font-semibold text-base-content/70">No Users Found</p>
                                <p class="text-sm text-base-content/50">There are currently no users matching your criteria.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                </table>
            </div>

            <!-- Enhanced pagination controls with improved visual design -->
            <div class="bg-gradient-to-r from-base-200/60 to-base-200/30 p-5 border-t border-base-300/40 flex flex-wrap justify-between items-center gap-4 relative overflow-hidden">
                <!-- Subtle decorative elements -->
                <div class="absolute -bottom-12 -right-12 w-32 h-32 bg-primary/5 rounded-full blur-xl animate-pulse" style="animation-duration: 15s;"></div>
                <div class="absolute -top-8 -left-8 w-24 h-24 bg-secondary/5 rounded-full blur-xl animate-pulse" style="animation-duration: 18s;"></div>
                <div class="absolute bottom-0 left-0 w-1/3 h-0.5 bg-gradient-to-r from-primary/20 to-transparent"></div>
                <div class="absolute top-0 right-0 w-1/3 h-0.5 bg-gradient-to-l from-secondary/20 to-transparent"></div>

                <!-- Enhanced pagination info with animation and styling -->
                <div class="text-sm text-base-content/70 flex items-center gap-2 group/info relative">
                    <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shadow-sm">
                        <i class="fas fa-users text-xs text-primary/80 group-hover/info:scale-110 transition-transform duration-300"></i>
                    </div>
                    <div>
                        Showing <span class="font-medium text-base-content/90 px-1">1-10</span> of
                        <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent font-semibold relative group-hover/info:scale-105 transition-transform inline-flex items-center">
                            {{ users|length }}
                            <span class="text-xs ml-1 text-base-content/50">users</span>
                            <span class="absolute -bottom-0.5 left-0 right-0 h-0.5 bg-gradient-to-r from-primary/50 to-secondary/50 transform scale-x-0 group-hover/info:scale-x-100 transition-transform duration-300"></span>
                        </span>
                    </div>
                </div>

                <!-- Beautifully styled pagination controls -->
                <div class="flex items-center gap-3">
                    <!-- Page size selector with dropdown -->
                    <div class="dropdown dropdown-top dropdown-end">
                        <label tabindex="0" class="btn btn-sm btn-ghost border border-base-300/40 gap-1 px-3 hover:bg-base-200 transition-all">
                            <span class="text-xs">Show</span>
                            <span class="font-medium">10</span>
                            <i class="fas fa-chevron-down text-[0.6rem] opacity-60 mt-0.5"></i>
                        </label>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow-lg bg-base-100/95 rounded-box w-40 border border-base-300/30 backdrop-blur-md">
                            <li><a class="text-xs active:bg-primary/10">10 per page</a></li>
                            <li><a class="text-xs active:bg-primary/10">25 per page</a></li>
                            <li><a class="text-xs active:bg-primary/10">50 per page</a></li>
                            <li><a class="text-xs active:bg-primary/10">Show all</a></li>
                        </ul>
                    </div>

                    <!-- Enhanced pagination buttons with animations and effects -->
                    <div class="join shadow-md rounded-xl overflow-hidden border border-base-300/40 bg-base-100">
                        <!-- First page button -->
                        <button class="join-item btn btn-sm px-3 bg-base-100 hover:bg-base-200/80 border-0 group/btn relative">
                            <span class="absolute inset-0 bg-primary/10 transform scale-x-0 group-hover/btn:scale-x-100 transition-transform origin-left"></span>
                            <i class="fas fa-angle-double-left text-xs relative z-10 group-hover/btn:text-primary transition-colors"></i>
                            <span class="sr-only">First</span>
                        </button>

                        <!-- Previous page button -->
                        <button class="join-item btn btn-sm px-3 bg-base-100 hover:bg-base-200/80 border-0 group/btn relative">
                            <span class="absolute inset-0 bg-primary/10 transform scale-x-0 group-hover/btn:scale-x-100 transition-transform origin-left"></span>
                            <i class="fas fa-angle-left text-xs relative z-10 group-hover/btn:text-primary transition-colors"></i>
                            <span class="sr-only">Previous</span>
                        </button>

                        <!-- Page numbers with active state -->
                        <button class="join-item btn btn-sm bg-primary text-primary-content border-0 px-4 relative overflow-hidden group/active">
                            <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover/active:translate-x-0 transition-transform duration-300"></span>
                            <span class="relative z-10">1</span>
                            <span class="absolute bottom-0 left-0 right-0 h-1 bg-primary-content/30"></span>
                        </button>

                        <button class="join-item btn btn-sm bg-base-100 hover:bg-base-200/80 border-0 px-4 group/btn relative overflow-hidden">
                            <span class="absolute inset-0 bg-primary/10 transform scale-x-0 group-hover/btn:scale-x-100 transition-transform origin-left"></span>
                            <span class="relative z-10 group-hover/btn:text-primary transition-colors">2</span>
                        </button>

                        <button class="join-item btn btn-sm bg-base-100 hover:bg-base-200/80 border-0 px-4 group/btn relative overflow-hidden">
                            <span class="absolute inset-0 bg-primary/10 transform scale-x-0 group-hover/btn:scale-x-100 transition-transform origin-left"></span>
                            <span class="relative z-10 group-hover/btn:text-primary transition-colors">3</span>
                        </button>

                        <!-- Next page button -->
                        <button class="join-item btn btn-sm px-3 bg-base-100 hover:bg-base-200/80 border-0 group/btn relative">
                            <span class="absolute inset-0 bg-primary/10 transform scale-x-0 group-hover/btn:scale-x-100 transition-transform origin-left"></span>
                            <i class="fas fa-angle-right text-xs relative z-10 group-hover/btn:text-primary transition-colors"></i>
                            <span class="sr-only">Next</span>
                        </button>

                        <!-- Last page button -->
                        <button class="join-item btn btn-sm px-3 bg-base-100 hover:bg-base-200/80 border-0 group/btn relative">
                            <span class="absolute inset-0 bg-primary/10 transform scale-x-0 group-hover/btn:scale-x-100 transition-transform origin-left"></span>
                            <i class="fas fa-angle-double-right text-xs relative z-10 group-hover/btn:text-primary transition-colors"></i>
                            <span class="sr-only">Last</span>
                        </button>
                    </div>

                    <!-- Jump to page input -->
                    <div class="relative group/jump hidden sm:flex items-center">
                        <input type="number" min="1" max="3" placeholder="Go to" class="input input-sm w-16 pr-6 bg-base-100 border-base-300/40 focus:border-primary/60 focus:outline-none rounded-lg text-center text-sm" />
                        <button class="absolute right-2 top-1/2 -translate-y-1/2 text-base-content/50 hover:text-primary transition-colors">
                            <i class="fas fa-arrow-right text-xs"></i>
                        </button>
                        <span class="absolute -bottom-5 left-0 right-0 text-xs text-base-content/50 opacity-0 group-focus-within/jump:opacity-100 transition-opacity text-center">Press Enter</span>
                    </div>                </div>
            </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal Dialogs for User Management -->
{% for user in users %}
<!-- Change Role Modal -->
<dialog id="modal-change-role-{{ user.id }}" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box bg-base-100 relative overflow-hidden shadow-2xl rounded-2xl border border-primary/20 break-words">
        <!-- Decorative background elements -->
        <div class="absolute -top-24 -right-24 w-56 h-56 bg-gradient-to-br from-primary/20 to-secondary/10 rounded-full blur-2xl animate-pulse" style="animation-duration: 10s;"></div>
        <div class="absolute -bottom-24 -left-24 w-56 h-56 bg-gradient-to-tr from-secondary/20 to-primary/10 rounded-full blur-2xl animate-pulse" style="animation-duration: 14s; animation-delay: 2s;"></div>
        <div class="absolute inset-0 bg-grid-pattern opacity-[0.04] mix-blend-overlay"></div>

        <button class="btn btn-sm btn-circle btn-ghost absolute right-3 top-3 text-base-content/70 hover:text-primary transition-colors duration-200 z-10" onclick="document.getElementById('modal-change-role-{{ user.id }}').close()"></button>

        <div class="flex items-center gap-4 mb-7">
            <div class="avatar relative group/avatar">
                <div class="w-14 h-14 rounded-full bg-gradient-to-br from-primary/40 via-primary/20 to-secondary/30 flex items-center justify-center overflow-hidden border-2 border-primary/40 shadow-lg group-hover/avatar:scale-105 transition-transform duration-300">
                    {% if user.profile.profile_image %}
                        <img src="{{ user.profile.profile_image.url }}" alt="{{ user.username }}" class="object-cover w-full h-full">
                    {% else %}
                        <span class="font-bold bg-gradient-to-br from-primary to-secondary bg-clip-text text-transparent text-2xl">{{ user.username|first|upper }}</span>
                    {% endif %}
                </div>
                <span class="absolute -bottom-1 -right-1 w-4 h-4 bg-success border-2 border-base-100 rounded-full shadow-md opacity-0 group-hover/avatar:opacity-100 transition-opacity"></span>
            </div>
            <div>
                <h3 class="font-bold text-xl text-base-content flex items-center gap-2 break-words">
                    {{ user.username }}
                    <span class="badge badge-primary badge-sm shadow-md shadow-primary/20">{{ user.profile.get_role_display }}</span>
                </h3>
                <p class="text-base-content/60 text-sm break-all">{{ user.email }}</p>
            </div>
        </div>

        <h3 class="text-xl font-semibold mb-2 text-base-content/90 tracking-tight">Change User Role</h3>
        <p class="text-base-content/70 mb-6 text-sm break-words">Select a new role for this user. This will update their permissions instantly.</p>

        <form action="{% url 'update_user_role' user.id %}" method="post" class="space-y-5">
            {% csrf_token %}
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <label class="label cursor-pointer bg-base-200/60 hover:bg-primary/10 rounded-xl p-5 flex items-start gap-3 transition-all border border-base-300/50 hover:border-primary/40 shadow group/role break-words">
                    <input type="radio" name="role" value="user" class="radio radio-primary mt-1" {% if user.profile.role == 'user' %}checked{% endif %}>
                    <div class="flex flex-col min-w-0">
                        <span class="label-text font-semibold flex items-center gap-2 text-base-content group-hover/role:text-primary transition-colors break-words">
                            <i class="fas fa-user text-base-content/80"></i>
                            Regular User
                        </span>
                        <span class="text-xs text-base-content/60 mt-1 break-words">Basic access to site features</span>
                    </div>
                </label>

                <label class="label cursor-pointer bg-base-200/60 hover:bg-secondary/10 rounded-xl p-5 flex items-start gap-3 transition-all border border-base-300/50 hover:border-secondary/40 shadow group/role break-words">
                    <input type="radio" name="role" value="staff" class="radio radio-secondary mt-1" {% if user.profile.role == 'staff' %}checked{% endif %}>
                    <div class="flex flex-col min-w-0">
                        <span class="label-text font-semibold flex items-center gap-2 text-base-content group-hover/role:text-secondary transition-colors break-words">
                            <i class="fas fa-user-tie text-secondary"></i>
                            Staff
                        </span>
                        <span class="text-xs text-base-content/60 mt-1 break-words">Customer service capabilities</span>
                    </div>
                </label>

                <label class="label cursor-pointer bg-base-200/60 hover:bg-accent/10 rounded-xl p-5 flex items-start gap-3 transition-all border border-base-300/50 hover:border-accent/40 shadow group/role break-words">
                    <input type="radio" name="role" value="content_manager" class="radio radio-accent mt-1" {% if user.profile.role == 'content_manager' %}checked{% endif %}>
                    <div class="flex flex-col min-w-0">
                        <span class="label-text font-semibold flex items-center gap-2 text-base-content group-hover/role:text-accent transition-colors break-words">
                            <i class="fas fa-pen text-accent"></i>
                            Content Manager
                        </span>
                        <span class="text-xs text-base-content/60 mt-1 break-words">Manage products and content</span>
                    </div>
                </label>

                <label class="label cursor-pointer bg-base-200/60 hover:bg-info/10 rounded-xl p-5 flex items-start gap-3 transition-all border border-base-300/50 hover:border-info/40 shadow group/role break-words">
                    <input type="radio" name="role" value="blogger" class="radio radio-info mt-1" {% if user.profile.role == 'blogger' %}checked{% endif %}>
                    <div class="flex flex-col min-w-0">
                        <span class="label-text font-semibold flex items-center gap-2 text-base-content group-hover/role:text-info transition-colors break-words">
                            <i class="fas fa-feather-alt text-info"></i>
                            Blogger
                        </span>
                        <span class="text-xs text-base-content/60 mt-1 break-words">Create and manage blog posts</span>
                    </div>
                </label>

                <label class="label cursor-pointer bg-base-200/60 hover:bg-primary/10 rounded-xl p-5 flex items-start gap-3 transition-all border border-base-300/50 hover:border-primary/40 shadow group/role col-span-1 sm:col-span-2 break-words">
                    <input type="radio" name="role" value="admin" class="radio radio-primary mt-1" {% if user.profile.role == 'admin' %}checked{% endif %}>
                    <div class="flex flex-col min-w-0">
                        <span class="label-text font-semibold flex items-center gap-2 text-base-content group-hover/role:text-primary transition-colors break-words">
                            <i class="fas fa-shield-alt text-primary"></i>
                            Administrator
                        </span>
                        <span class="text-xs text-base-content/60 mt-1 break-words">Full access to all site features and settings</span>
                    </div>                </label>
            </div>

            <div class="modal-action flex items-center justify-between mt-7">
                <button type="button" class="btn btn-ghost btn-md px-6" onclick="document.getElementById('modal-change-role-{{ user.id }}').close()">
                    <i class="fas fa-times mr-2"></i>
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary btn-md gap-2 group relative overflow-hidden px-7 shadow-lg shadow-primary/10">
                    <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></span>
                    <i class="fas fa-check relative z-10"></i>
                    <span class="relative z-10">OK - Update Role</span>
                </button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<!-- Delete User Modal -->
<dialog id="modal-delete-user-{{ user.id }}" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box bg-base-100 relative overflow-hidden shadow-2xl rounded-2xl border border-error/20">
        <!-- Decorative background elements -->
        <div class="absolute -top-24 -right-24 w-56 h-56 bg-gradient-to-br from-error/20 to-error/5 rounded-full blur-2xl animate-pulse" style="animation-duration: 8s;"></div>
        <div class="absolute -bottom-24 -left-24 w-56 h-56 bg-gradient-to-tr from-error/10 to-error/5 rounded-full blur-2xl animate-pulse" style="animation-duration: 12s; animation-delay: 2s;"></div>
        <div class="absolute inset-0 bg-grid-pattern opacity-[0.04] mix-blend-overlay"></div>

        <button class="btn btn-sm btn-circle btn-ghost absolute right-3 top-3 text-base-content/70 hover:text-error transition-colors duration-200 z-10" onclick="document.getElementById('modal-delete-user-{{ user.id }}').close()"></button>

        <div class="flex flex-col items-center justify-center py-6">
            <div class="w-20 h-20 bg-gradient-to-br from-error/20 to-error/10 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-error/10 animate-pulse" style="animation-duration: 2.5s;">
                <i class="fas fa-exclamation-triangle text-4xl text-error drop-shadow-lg"></i>
            </div>

            <h3 class="font-bold text-2xl mb-2 text-error tracking-tight flex items-center gap-2">
                <i class="fas fa-user-slash text-error/80"></i>
                Delete User Account
            </h3>
            <p class="text-center text-base-content/80 mb-5 text-sm max-w-md">
                Are you sure you want to <span class="font-semibold text-error">permanently delete</span> the account for
                <span class="font-semibold text-error">{{ user.username }}</span>?<br>
                <span class="text-base-content/60">This action <span class="font-bold text-error">cannot be undone</span>.</span>
            </p>

            <div class="bg-gradient-to-br from-error/10 to-error/5 text-error rounded-xl p-4 max-w-sm mx-auto mb-6 text-sm border border-error/20 shadow-md">
                <ul class="list-disc list-inside space-y-1">
                    <li>All user data will be <span class="font-semibold">permanently removed</span></li>
                    <li>Associated reviews and comments will be deleted</li>
                    <li>Order history will be anonymized</li>
                </ul>
            </div>

            <form action="{% url 'delete_user' user.id %}" method="post" class="w-full">
                {% csrf_token %}
                <div class="flex items-start mb-6 gap-3">
                    <input type="checkbox" required class="checkbox checkbox-error mt-1" id="confirm-delete-{{ user.id }}">
                    <label for="confirm-delete-{{ user.id }}" class="text-sm text-base-content/80 select-none">
                        I confirm that I want to <span class="font-semibold text-error">permanently delete</span> this user account
                    </label>
                </div>

                <div class="modal-action flex items-center gap-4 justify-end mt-7">
                    <button type="submit" class="btn btn-error btn-md gap-2 group relative overflow-hidden px-7 shadow-lg shadow-error/10">
                        <span class="absolute inset-0 bg-white/20 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></span>
                        <i class="fas fa-trash-alt relative z-10"></i>
                        <span class="relative z-10">Delete User</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
{% endfor %}

<!-- JavaScript for enhanced functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Search functionality
    const searchInput = document.querySelector('input[placeholder="Search by name, email or role..."]');
    const tableRows = document.querySelectorAll('tbody tr');

    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();

            tableRows.forEach(row => {
                const username = row.querySelector('td:first-child').textContent.toLowerCase();
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const email = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const role = row.querySelector('td:nth-child(4)').textContent.toLowerCase();

                const isVisible = username.includes(searchTerm) ||
                                name.includes(searchTerm) ||
                                email.includes(searchTerm) ||
                                role.includes(searchTerm);

                row.style.display = isVisible ? '' : 'none';
            });
        });
    }

    // Copy email functionality
    window.copyEmail = function(email) {
        navigator.clipboard.writeText(email).then(function() {
            // Show success message
            const btn = event.target.closest('button');
            const tooltip = btn.querySelector('.tooltip-content');
            if (tooltip) {
                tooltip.classList.remove('hidden');
                setTimeout(() => {
                    tooltip.classList.add('hidden');
                }, 2000);
            }
        });
    };

    // Modal management
    window.openRoleModal = function(userId) {
        const modal = document.getElementById('modal-change-role-' + userId);
        if (modal) {
            modal.showModal();
        }
    };

    window.closeRoleModal = function(userId) {
        const modal = document.getElementById('modal-change-role-' + userId);
        if (modal) {
            modal.close();
        }
    };    // Sort functionality
    let currentSortColumn = '';
    let currentSortDirection = 'asc';

    function updateSortIcons() {
        document.querySelectorAll('th [data-sort]').forEach(headerItem => {
            const sortIcon = headerItem.querySelector('i');
            if (headerItem.dataset.sort === currentSortColumn) {
                sortIcon.className = currentSortDirection === 'asc'
                    ? 'fas fa-sort-up text-[0.6rem] opacity-100 text-primary'
                    : 'fas fa-sort-down text-[0.6rem] opacity-100 text-primary';
                headerItem.classList.add('text-primary');

                // Add active indicator
                const headerContainer = headerItem.closest('th');
                const indicator = headerContainer.querySelector('.sort-indicator') || document.createElement('div');
                if (!headerContainer.querySelector('.sort-indicator')) {
                    indicator.className = 'sort-indicator absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-primary/50 to-primary/80 animate-gradient-x';
                    headerContainer.style.position = 'relative';
                    headerContainer.appendChild(indicator);
                }
            } else {
                sortIcon.className = 'fas fa-sort text-[0.6rem] opacity-60 group-hover:opacity-100';
                headerItem.classList.remove('text-primary');

                // Remove active indicator
                const headerContainer = headerItem.closest('th');
                const indicator = headerContainer.querySelector('.sort-indicator');
                if (indicator) {
                    headerContainer.removeChild(indicator);
                }
            }
        });
    }

    document.querySelectorAll('th [data-sort]').forEach(element => {
        element.addEventListener('click', function() {
            const column = this.dataset.sort;

            // Toggle direction if clicking the same column
            if (column === currentSortColumn) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }

            updateSortIcons();

            const tbody = document.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            // Remove empty rows from sorting (like "No Users Found" row)
            const nonEmptyRows = rows.filter(row => {
                const cells = row.querySelectorAll('td');
                return cells.length > 1;
            });

            nonEmptyRows.sort((a, b) => {
                const columnIndex = getColumnIndex(column);
                let aVal, bVal;

                if (column === 'joined') {
                    // For date columns, extract the full date for proper sorting
                    const aDateEl = a.querySelector(`td:nth-child(${columnIndex}) span.text-xs`);
                    const bDateEl = b.querySelector(`td:nth-child(${columnIndex}) span.text-xs`);
                    aVal = aDateEl ? aDateEl.textContent.trim() : '';
                    bVal = bDateEl ? bDateEl.textContent.trim() : '';
                } else {
                    aVal = a.querySelector(`td:nth-child(${columnIndex})`).textContent.trim();
                    bVal = b.querySelector(`td:nth-child(${columnIndex})`).textContent.trim();
                }

                // Apply visual indication of sorting
                const multiplier = currentSortDirection === 'asc' ? 1 : -1;
                return multiplier * aVal.localeCompare(bVal, undefined, {
                    numeric: true, // Handle numbers correctly
                    sensitivity: 'base' // Ignore case
                });
            });

            // Apply a smooth animation effect
            nonEmptyRows.forEach((row, index) => {
                row.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
                row.style.opacity = '0';
                row.style.transform = 'translateY(10px)';

                // Move rows to their new positions
                tbody.appendChild(row);

                // Add staggered fade-in animation
                setTimeout(() => {
                    row.style.opacity = '1';
                    row.style.transform = 'translateY(0)';
                }, 50 * index);
            });

            // Show sorting feedback to user
            const sortingInfo = document.createElement('div');
            sortingInfo.className = 'fixed bottom-4 right-4 bg-primary text-primary-content px-4 py-2 rounded-full shadow-lg z-50 flex items-center gap-2 text-sm animate-fade-in';
            sortingInfo.innerHTML = `<i class="fas fa-sort-${currentSortDirection === 'asc' ? 'up' : 'down'}"></i> Sorted by ${column} (${currentSortDirection === 'asc' ? 'A-Z' : 'Z-A'})`;
            document.body.appendChild(sortingInfo);

            setTimeout(() => {
                sortingInfo.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(sortingInfo);
                }, 300);
            }, 2000);
        });
    });

    function getColumnIndex(column) {
        switch(column) {
            case 'username': return 1;
            case 'name': return 2;
            case 'email': return 3;
            case 'role': return 4;
            case 'joined': return 5;
            default: return 1;
        }
    }

    // Jump to page functionality
    const jumpInput = document.querySelector('input[placeholder="Go to"]');
    if (jumpInput) {
        jumpInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const page = parseInt(this.value);
                if (page >= 1 && page <= 3) {
                    // Add page navigation logic here
                    // Navigate to selected page
                }
            }
        });
    }

    // Animation cleanup
    const animatedElements = document.querySelectorAll('[class*="animate-"]');
    animatedElements.forEach(el => {
        el.addEventListener('animationend', function() {
            // Clean up animation classes if needed
        });
    });
});
</script>

<!-- Custom CSS for animations -->
<style>
@keyframes gradient-x {
    0%, 100% {
        background-size: 200% 200%;
        background-position: left center;
    }
    50% {
        background-size: 200% 200%;
        background-position: right center;
    }
}

@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

@keyframes fade-in {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fade-out {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(10px);
    }
}

@keyframes shimmer-highlight {
    0% {
        background-position: -100% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

.animate-gradient-x {
    animation: gradient-x 15s ease infinite;
}

.animate-shimmer {
    animation: shimmer 2s infinite;
}

.animate-fade-in {
    animation: fade-in 0.3s ease;
}

.animate-fade-out {
    animation: fade-out 0.3s ease;
}

.animate-shimmer-highlight {
    background: linear-gradient(90deg,
                transparent,
                rgba(var(--primary-rgb), 0.2),
                transparent);
    background-size: 200% 100%;
    animation: shimmer-highlight 1.5s ease-in-out;
}

.animate-spin-slow {
    animation: spin 3s linear infinite;
}

.sortable-header:hover {
    cursor: pointer;
    color: hsl(var(--p));
}

th.sorting {
    color: hsl(var(--p));
    position: relative;
}

th.sorting:after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 2px;
    background: linear-gradient(to right, hsl(var(--p)/0.5), hsl(var(--p)));
}

.bg-grid-pattern {
    background-image:
        linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px);
    background-size: 20px 20px;
}

/* Enhanced hover states */
.group:hover .group-hover\:scale-110 {
    transform: scale(1.1);
}

.group:hover .group-hover\:rotate-12 {
    transform: rotate(12deg);
}

.group:hover .group-hover\:rotate-\[-12deg\] {
    transform: rotate(-12deg);
}

.group:hover .group-hover\:translate-y-\[-2px\] {
    transform: translateY(-2px);
}

/* Tooltip styles */
.tooltip {
    position: relative;
}

.tooltip:hover::after {
    content: attr(data-tip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
}
</style>
{% endblock content %}